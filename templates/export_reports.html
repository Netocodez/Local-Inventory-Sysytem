{% extends "base.html" %}
{% block content %}
<h1 class="mb-4">Export Reports</h1>

<form method="get" action="{{ url_for('report.export_reports') }}" class="row row-cols-1 row-cols-md-auto g-3 align-items-end mb-4">
    <div class="col">
        <label for="start_date" class="form-label fw-bold">Start Date:</label>
        <input type="date" id="start_date" name="start_date" class="form-control" value="{{ start_date }}">
    </div>
    <div class="col">
        <label for="end_date" class="form-label fw-bold">End Date:</label>
        <input type="date" id="end_date" name="end_date" class="form-control" value="{{ end_date }}">
    </div>
    <div class="col d-grid">
        <label class="invisible">Filter</label>  <!-- invisible label keeps spacing -->
        <button type="submit" class="btn btn-primary">Filter Sales</button>
    </div>
</form>


<!-- Flash Messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="alert alert-dark alert-dismissible fade show flash-message" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endfor %}
  {% endif %}
{% endwith %}

{% if sales %}
<div class="table-responsive">
    <table class="table table-bordered table-striped align-middle nowrap" id="sales-table" style="width:100%">
        <thead class="table-success">
            <tr>
                <th>ID</th>
                <th>Trans ID</th>
                <th>Product</th>
                <th>Quantity</th>
                <th>Unit Price</th>
                <th>Total Price</th>
                <th>Comments</th>
                <th>User</th>
                <th>Date</th>
            </tr>
        </thead>
        <tbody>
            {% for sale in sales %}
            <tr>
                <td>{{ sale.id }}</td>
                <td>{{ sale.transaction_id }}</td>
                <td>{{ sale.product_name }}</td>
                <td>{{ sale.quantity }}</td>
                <td>₦{{ "%.2f"|format(sale.unit_price) }}</td>
                <td>₦{{ "%.2f"|format(sale.total_price) }}</td>
                <td>{{ sale.comments or '-' }}</td>
                <td>{{ sale.username }}</td>
                <td style="white-space: nowrap;">{{ sale.timestamp }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<p class="text-muted">No sales found for the selected period.</p>
{% endif %}

<div class="d-flex gap-2 mt-4">
    <a href="{{ url_for('report.export_sales', start_date=start_date, end_date=end_date) }}" class="btn btn-success">Export Filtered Sales</a>
    <a href="{{ url_for('report.export_products') }}" class="btn btn-success">Export Products</a>
</div>
{% endblock %}
